<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="./katex.min.css">
    <script src="./katex.min.js"></script>

    <style>
        /* 1. 全局样式 */
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            width: 100%;
            height: auto;
            min-height: 100vh;
            background-color: #ffffff;
            overflow-x: hidden; /* 禁止横向滚动，强制换行 */
            overflow-y: hidden;
        }

        /* 2. 容器样式 */
        #formula-container {
            /* 【修改 1】缩小字体: 2.0 -> 1.5em (满足你的要求) */
            font-size: 1.5em;

            color: #000;
            width: 100%;
            height: auto;
            box-sizing: border-box;

            /* 【修改 2】开启换行 (解决 9999... 不换行问题) */
            white-space: normal;
            word-wrap: break-word;
            word-break: break-all; /* 允许在数字中间暴力折行 */

            text-align: left;
            padding: 8px; /* 稍微给一点点呼吸空间，不再是 77px 那么夸张 */
            margin: 0;
            line-height: 1.5; /* 增加行高，防止换行后上下重叠 */
        }

        /* 3. KaTeX 样式微调 */
        .katex {
            font-size: 1em !important;
            text-align: left !important;
            /* 允许内部换行 */
            white-space: normal !important;
        }

        /* 根号和分数内部尽量保持完整，但如果实在太长也没办法 */
        .base {
            width: auto !important;
        }

        /* 光标 */
        .cursor-blink {
            color: #FF0055;
            animation: blink 1s step-end infinite;
            font-weight: 100;
            margin: 0 1px;
            display: inline-block;
            vertical-align: middle;
            height: 1em;
            border-right: 2px solid #FF0055;
        }
        @keyframes blink { from, to { opacity: 1; } 50% { opacity: 0; } }
    </style>
</head>
<body>
<div id="formula-container"></div>

<script>
    window.updateFormula = function(latex) {
        const container = document.getElementById('formula-container');
        if (!container) return;

        container.innerHTML = '';

        try {
            if (!latex) return;

            katex.render(latex, container, {
                throwOnError: false,
                // 【核心修改】关闭 displayMode
                // 这样 KaTeX 就不会自作主张加 padding，也不会强制居中
                displayMode: false,
                strict: false,
                output: 'html',
                trust: true,
                // fleqn 在 displayMode: false 下无效，所以不需要担心它带来的 padding
            });

        } catch (e) {
            console.error(e.message);
        }
    }
</script>
</body>
</html>